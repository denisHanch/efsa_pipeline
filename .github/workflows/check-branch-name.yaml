name: "CHECK: Branch Naming"

on:
  pull_request:
    branches:
      - main

jobs:
  branch-name-check:
    runs-on: ubuntu-latest
    steps:
      - name: Check branch name convention
        run: |
          BRANCH="${{ github.head_ref }}"
          ISSUE_PREFIX="${{ vars.PROJECT_PREFIX }}"
          
          # Allow quick-fix branches prefixed with "no-issue"
          if [[ "$BRANCH" =~ ^no-issue ]]; then
            echo "✅ Detected 'no-issue' branch – skipping naming convention."
            exit 0
          fi

          # Enforce naming cinvention check
          if ! [[ $BRANCH =~ ^(feature|bugfix|docs)/${ISSUE_PREFIX}-[0-9]+_.+ ]]; then
            echo "❗ Branch name is invalid. Must follow pattern:"
            echo "  (feature|bugfix|docs)/${ISSUE_PREFIX}-<number>_your_branch_name"
            echo "  or start with 'no-issue'"
            exit 1
          else
            echo "✅ Branch name valid: $BRANCH"
          fi
