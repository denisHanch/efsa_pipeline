- name: Check commit message format
  run: |
    ISSUE_PREFIX="${{ vars.PROJECT_PREFIX }}"
    
    # Fetch main branch
    git fetch origin main:main
    
    # Check only commits not in main
    invalid_msgs=$(
      git log --no-merges --format="%s" main..HEAD \
      | grep -vE "^(${IGNORE_PREFIX}|${ISSUE_PREFIX}-[0-9]+: .+)" \
      || true
    )
    
    if [ -n "$invalid_msgs" ]; then
      echo "üö® Invalid commit message(s) detected:"
      echo "$invalid_msgs"
      echo "‚ùó Expected format: '${ISSUE_PREFIX}-<#ISSUE>: Your commit message' or start with '${IGNORE_PREFIX}'"
      exit 1
    else
      echo "‚úÖ All commit messages are valid!"
    fi